import{j as y,d as v,b as w,g as l,k as b,h as E,R as I,a as u}from"./firebase-init-C-AE0vWN.js";/* empty css                   */document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("phone-number-input"),i=document.getElementById("send-otp-button"),p=document.getElementById("verify-otp-button"),h=document.getElementById("otp-section"),o=document.getElementById("otp-fieldset").querySelectorAll("input"),s=document.getElementById("error-message");function f(){window.recaptchaVerifier=new I(u,"recaptcha-container",{size:"invisible",callback:n=>{console.log("reCAPTCHA solved, sending OTP")}})}f(),i.addEventListener("click",()=>{const n=document.getElementById("country-code-select").value,e=m.value,t=window.recaptchaVerifier,r=n+e;y(u,r,t).then(a=>{console.log("OTP sent"),window.confirmationResult=a,h.classList.remove("hidden"),s.textContent="",i.parentElement.style.display="none",document.getElementById("phone-number-input").parentElement.parentElement.style.display="none"}).catch(a=>{console.error("Error sending OTP:",a),s.textContent="Error sending OTP. Please try again.",window.recaptchaVerifier.render().then(function(c){grecaptcha.reset(c)})})}),p.addEventListener("click",()=>{const n=Array.from(document.querySelectorAll(".otp-input")).map(e=>e.value).join("");if(!n||n.length!==6){s.textContent="Please enter a valid 6-digit OTP.";return}window.confirmationResult.confirm(n).then(async e=>{const t=e.user,r=v(w,"users",t.uid);try{(await l(r)).exists()?console.log("User already exists in database"):(await b(r,{phoneNumber:t.phoneNumber,uid:t.uid,khatu_website_admin:!1,createdAt:E(),name:t.phoneNumber,email:"",address:""}),console.log("New user added to Firestore database")),(await l(r)).data().khatu_website_admin===!0?window.location.href="admin_dashboard.html":window.location.href="dashboard.html"}catch(a){console.error("Error saving or retrieving user data:",a),s.textContent="Login successful but could not retrieve user data. Please contact support."}}).catch(e=>{s.textContent="Invalid verification code. Please try again.",console.error("Verification error:",e)})}),o.forEach((n,e)=>{n.addEventListener("input",t=>{n.value.length===n.maxLength&&e<o.length-1&&o[e+1].focus()}),n.addEventListener("keydown",t=>{t.key==="Backspace"&&n.value===""&&e>0||t.key==="ArrowLeft"&&e>0?o[e-1].focus():t.key==="ArrowRight"&&e<o.length-1&&o[e+1].focus()}),n.addEventListener("paste",t=>{t.preventDefault();const r=t.clipboardData.getData("text");r.split("").slice(0,o.length).forEach((d,g)=>{o[g].value=d});const c=Math.min(o.length-1,r.length);o[c].focus()})})});
