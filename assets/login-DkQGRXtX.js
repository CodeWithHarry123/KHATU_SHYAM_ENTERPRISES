/* empty css                   */(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const t of e.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&i(t)}).observe(document,{childList:!0,subtree:!0});function d(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(o){if(o.ep)return;o.ep=!0;const e=d(o);fetch(o.href,e)}})();document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("phone-number-input"),a=document.getElementById("send-otp-button"),d=document.getElementById("verify-otp-button"),i=document.getElementById("otp-section"),e=document.getElementById("otp-fieldset").querySelectorAll("input");window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier("recaptcha-container",{size:"invisible",callback:t=>{console.log("reCAPTCHA solved")}}),a.addEventListener("click",()=>{const t="+91"+l.value,n=window.recaptchaVerifier;auth.signInWithPhoneNumber(t,n).then(r=>{window.confirmationResult=r,i.classList.remove("hidden"),a.parentElement.style.display="none",l.disabled=!0,e[0].focus(),alert("OTP has been sent!")}).catch(r=>{console.error("Error sending OTP: ",r),recaptchaVerifier.render().then(s=>recaptchaVerifier.reset(s)),alert("Error sending OTP. Please try again.")})}),d.addEventListener("click",()=>{const t=Array.from(document.querySelectorAll(".otp-input")).map(r=>r.value).join(""),n=document.getElementById("error-message");if(!t||t.length!==6){n.textContent="Please enter a valid 6-digit OTP.";return}confirmationResult.confirm(t).then(async r=>{const s=r.user,u=s.phoneNumber;try{(await db.collection("users").doc(s.uid).get()).exists?console.log("User already exists in database"):(await db.collection("users").doc(s.uid).set({phoneNumber:u,uid:s.uid,khatu_website_admin:!1,createdAt:firebase.firestore.FieldValue.serverTimestamp(),name:u,email:"",address:""}),console.log("New user added to Firestore database")),(await db.collection("users").doc(s.uid).get()).data().khatu_website_admin===!0?window.location.href="admin_dashboard.html":window.location.href="dashboard.html"}catch(c){console.error("Error saving user to database:",c),n.textContent="Login successful but error saving user data. Please contact support."}}).catch(r=>{n.textContent="Invalid verification code. Please try again.",console.error("Verification error:",r)})}),e.forEach((t,n)=>{t.addEventListener("input",r=>{t.value.length===t.maxLength&&n<e.length-1&&e[n+1].focus()}),t.addEventListener("keydown",r=>{r.key==="Backspace"&&t.value===""&&n>0||r.key==="ArrowLeft"&&n>0?e[n-1].focus():r.key==="ArrowRight"&&n<e.length-1&&e[n+1].focus()}),t.addEventListener("paste",r=>{r.preventDefault();const s=r.clipboardData.getData("text");s.split("").slice(0,e.length).forEach((f,p)=>{e[p].value=f});const c=Math.min(e.length-1,s.length);e[c].focus()})})});
