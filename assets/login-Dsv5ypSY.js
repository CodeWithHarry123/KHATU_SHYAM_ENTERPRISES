import{R as w,a as u,j as g,d as v,b,g as h,k as y,h as C}from"./firebase-init-C-AE0vWN.js";/* empty css                   */document.addEventListener("DOMContentLoaded",()=>{const f=document.querySelector("#phone");window.iti=window.intlTelInput(f,{utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",initialCountry:"in"});const s=document.getElementById("send-otp-button"),c=document.getElementById("verify-otp-button"),p=document.getElementById("otp-section"),o=document.querySelectorAll("#otp-fieldset input"),r=document.getElementById("error-message");window.recaptchaVerifier=new w(u,"recaptcha-container",{size:"invisible",callback:e=>{console.log("reCAPTCHA solved, sending OTP")}}),s&&s.addEventListener("click",()=>{if(r.textContent="",window.iti&&window.iti.isValidNumber()){const e=window.iti.getNumber(),t=window.recaptchaVerifier;g(u,e,t).then(n=>{console.log("OTP sent to",e),window.confirmationResult=n,p.classList.remove("hidden"),r.textContent=""}).catch(n=>{console.error("Error sending OTP:",n),r.textContent="Error sending OTP. Please check the number and try again.",window.grecaptcha&&window.recaptchaWidgetId&&grecaptcha.reset(window.recaptchaWidgetId)})}else console.error("Invalid number entered"),r.textContent="Please enter a valid phone number."}),c&&c.addEventListener("click",()=>{const e=Array.from(o).map(t=>t.value).join("");if(!e||e.length!==6){r.textContent="Please enter a valid 6-digit OTP.";return}window.confirmationResult&&window.confirmationResult.confirm(e).then(async t=>{const n=t.user,a=v(b,"users",n.uid);try{(await h(a)).exists()?console.log("User already exists in database"):(await y(a,{phoneNumber:n.phoneNumber,uid:n.uid,khatu_website_admin:!1,createdAt:C(),name:n.phoneNumber,email:"",address:""}),console.log("New user added to Firestore database")),(await h(a)).data().khatu_website_admin===!0?window.location.href="admin_dashboard.html":window.location.href="dashboard.html"}catch(i){console.error("Error saving or retrieving user data:",i),r.textContent="Login successful but could not retrieve user data. Please contact support."}}).catch(t=>{r.textContent="Invalid verification code. Please try again.",console.error("Verification error:",t)})}),o.length>0&&o.forEach((e,t)=>{e.addEventListener("input",n=>{e.value.length===e.maxLength&&t<o.length-1&&o[t+1].focus()}),e.addEventListener("keydown",n=>{n.key==="Backspace"&&e.value===""&&t>0||n.key==="ArrowLeft"&&t>0?o[t-1].focus():n.key==="ArrowRight"&&t<o.length-1&&o[t+1].focus()}),e.addEventListener("paste",n=>{n.preventDefault();const a=n.clipboardData.getData("text");a.split("").slice(0,o.length).forEach((l,m)=>{o[m].value=l});const d=Math.min(o.length-1,a.length);o[d].focus()})}),window.recaptchaVerifier&&window.recaptchaVerifier.render().then(function(e){window.recaptchaWidgetId=e}).catch(e=>{console.error("reCAPTCHA rendering error:",e),r.textContent="Could not initialize reCAPTCHA. Please refresh the page and try again."})});
